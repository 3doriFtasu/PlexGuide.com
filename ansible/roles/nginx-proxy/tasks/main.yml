---

- name: Directory for Proxy
  file: "path={{item}} state=directory mode=0775 owner=1000 group=1000"
  with_items:
    - /opt/nginx-proxy

- name: Proxy File
  copy: "src=proxy.conf dest=/opt/appdata/nginx-proxy/proxy.conf force=yes owner=1000 group=1000 mode=0775"

- name: Remove Container
  docker_container:
    name: nginx-proxy
    state: absent

- name: Create Container
  docker_container:
    name: nginx-proxy
    image: "jwilder/nginx-proxy"
    pull: yes
    published_ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/opt/nginx-proxy:/etc/nginx/certs:ro"
      - "/var/run/docker.sock:/tmp/docker.sock:ro"
      - "/etc/nginx/vhost.d"
      - "/usr/share/nginx/html"
      - "/opt/appdata/nginx-proxy/proxy.conf:/etc/nginx/conf.d/proxy.conf"
    restart_policy: always
    state: started
    environment:
      - PUID=0
      - PGID=0