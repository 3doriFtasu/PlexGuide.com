---
- name: "Establishing Variable"
  shell: "awk '{print $1}' /tmp/program_var"
  register: program_var

- debug: msg="Temp Message - Deploy For {{program_var.stdout}}"

- name: Create {{program_var.stdout}}
  file: "path={{item}} state=directory mode=0775 owner=1000 group=1000"
  with_items:
    - /opt/plexguide/ansible
  ignore_errors: yes

- name: Build nginx 
   shell: |
     echo "ansible-playbook /opt/plexguide/ansible/plexguide.yml --tags backup" >> /opt/appdata/plexguide/cron/{{program_var.stdout}}           
     echo "echo "{{program_var.stdout}}" > /tmp/program_var" > /opt/appdata/plexguide/cron/{{program_var.stdout}} 

#- name: "Store Variable into Job"
  #shell: echo "echo "{{program_var.stdout}}" > /tmp/program_var" > /opt/appdata/plexguide/cron/{{program_var.stdout}} 

#- name: "Build Deploy Script"
  #shell: echo "ansible-playbook /opt/plexguide/ansible/plexguide.yml --tags backup" >> /opt/appdata/plexguide/cron/{{program_var.stdout}}           

- cron:
    name: Build a Hourly Cron Job - {{program_var.stdout}}
    special_time: hourly
    job: "bash /opt/appdata/plexguide/cron/{{program_var.stdout}}"
    state: present