#!/bin/bash
#
# Title:      PlexGuide (Reference Title File)
# Author(s):  Admin9705 - Deiteq
# URL:        https://plexguide.com - http://github.plexguide.com
# GNU:        General Public License v3.0
################################################################################
---
################################################################ PGDRIVE START
- hosts: localhost
  gather_facts: false
  tasks:
    
  - name: Deploy GDrive
    include_role:
      name: menu-move
      tasks_from: "deploy_gdrive.yml"

  - name: Deploy UnionFS
    include_role:
      name: menu-move
      tasks_from: "deploy_unionfs.yml"

  - name: Set to GDrive for Move
    set_fact:
      ver: "gdrive"
  ################################################################ ENCRYPTED START
  - name: Deploy GCrypt
    include_role:
      name: menu-move
      tasks_from: "deploy_gcrypt.yml"
    tags:
      - encrypted

  - name: Set to GCrypt if Encrypted Deploys
    set_fact:
      ver: "gcrypt"
    tags:
      - encrypted
  ################################################################ ENCRYPTED END

  ################################################################ PGMOVE START
  - name: Bandwidth Limit
    shell: "cat /var/plexguide/move.bw"
    register: bandwidth

  - name: Install MOVE Service
    template:
      src: move_script.js2
      dest: /opt/appdata/plexguide/move.sh
      force: yes

  - name: Install MOVE Service
    template:
      src: move.service
      dest: /etc/systemd/system/move.service
      force: yes

  - name: Daemon-Reload
    systemd: state=stopped name=move daemon_reload=yes enabled=no

  - name: Start UnionFS
    systemd: state=started name=move enabled=yes
