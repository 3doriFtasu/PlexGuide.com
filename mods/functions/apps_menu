#!/bin/bash
############# https://github.com/plexguide/PlexGuide.com/graphs/contributors ###
apps_menu() {

apps_interface_start

personal_blank () {
  if [[ $(ls /pg/mods/containers/personal) == "" ]]; then
  common_header "⛔️ WARNING! No Personnal Apps Detected! - plexguide.com/wiki/no-apps"
  common_confirm
  apps_menu && exit; fi
}

pull_check () {
pull_check=$(date +%s)
common_main /pg/var/defaults/pull.check "$pull_check" stored_check
common_main /pg/var/defaults/user.check Daily user_check
timediff=$(($pull_check-$stored_check))

to_pull="NULL"
if [[ "$user_check" == "Daily" ]]; then
  if [[ "$timediff" -gt 86400 ]]; then to_pull="ON"; else to_pull="OFF"; fi
elif [[ "$user_check" == "Weekly" ]]; then
  if [[ "$timediff" -gt 604800 ]]; then to_pull="ON"; else to_pull="OFF"; fi
elif [[ "$user_check" == "Hourly" ]]; then
  if [[ "$timediff" -gt 3600 ]]; then to_pull="ON"; else to_pull="OFF"; fi
elif [[ "$user_check" == "Immediate" ]]; then to_pull=on
elif [[ "$user_check" == "Off" ]]; then to_pull="OFF"; fi
}

pull_actions () {
if [[ "$to_pull" == "ON"]]; then
common_header "🚀  Pulling Latest App Repos"

common_header "💬 Pulling Personal Repo"
rm -rf /pg/var/personal
git clone -b ${personal3} --single-branch https://github.com/${personal1}/${personal2}.git /pg/var/personal
common_fcreate_silent /pg/var/personal
bash /pg/mods/functions/.create.sh 1>/dev/null 2>&1
bash /pg/mods/functions/.personal_apps.sh 1>/dev/null 2>&1
cp -f /pg/var/personal/* /pg/mods/containers/personal/ 1>/dev/null 2>&1
common_header "🚀  Application Pulls Complete"
fi
}

echo "TIME DIFF $timediff | to Pull $to_pull"
pull_check
common_message "🚀  PG Applications Interface" "💬 More Info? Visit ~ plexguide.com/wiki/apps | PULL: $to_pull

[1] Primary
[2] Community
[3] Personal
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
--- Settings -----------------------------------------------------------------
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[4] Repos
[5] Shield
[6] Default
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[Z] Exit Interface"

common_number

rm -rf /pg/tmp/appstoinstall.list && touch /pg/tmp/appstoinstall.list
touch /pg/tmp/list.tmp
case $typed in
    1 ) pull_actions && app="primary" && ls -p /pg/mods/containers/$sapp/ | grep -v / > "/pg/tmp/list.tmp" && apps_interface ;;
    2 ) pull_actions && sapp="community" && ls -p /pg/mods/containers/$sapp/ | grep -v / > "/pg/tmp/list.tmp" && apps_interface ;;
    3 ) pull_actions && personal_blank && sapp="personal" && ls -p /pg/mods/containers/$sapp/ | grep -v / > "/pg/tmp/list.tmp" && apps_interface ;;
    4 ) repos_part1 && exit ;;
    6 ) apps_default_interface ;;
    5 ) shield_setup ;;
    9 ) app="primary" && ls -p /pg/mods/containers/$sapp/ | grep -v / > "/pg/tmp/list.tmp" && apps_interface ;;
    z ) start_menu ;;
    Z ) start_menu ;;
    * ) apps_menu ;;
esac

}
